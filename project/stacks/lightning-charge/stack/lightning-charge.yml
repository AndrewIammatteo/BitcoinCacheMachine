version: '3.7'
services:
  lightning-charge:
    image: ${IMAGE_NAME}
    networks:
      bitcoindrpcnet:
      clightningnet:
      lightningchargenet:
        aliases:
          - lightningchargerpc-${CHAIN}
    volumes:
      - lightning-charge-data:/opt/charged
      - clightning-data:/etc/lightning
      - bitcoin-data:/etc/bitcoin
      - bitcoin-cli:/usr/local/bin
    environment:
      API_TOKEN: mySecretToken
      LN_PATH: /etc/lightning
      NETWORK: ${CHAIN:-testnet}
    deploy:
      mode: replicated
      replicas: 1
      placement:
        constraints:
          - engine.labels.bcm-bitcoin == true

volumes:
  lightning-charge-data:
  clightning-data:
    external: true
    name: clightning-${CHAIN:-testnet}_clightning-data

  bitcoin-data:
    external: true
    name: bitcoind-${CHAIN:-testnet}_bitcoin_data

  bitcoin-cli:
    external: true
    name: bitcoind-${CHAIN:-testnet}_bitcoin_cli

networks:
  lightningchargenet:
    attachable: true
  bitcoindrpcnet:
    external: true
    name: bitcoind-${CHAIN:-testnet}_bitcoindrpcnet
  clightningnet:
    external: true
    name: clightning-${CHAIN:-testnet}_clightningrpcnet
