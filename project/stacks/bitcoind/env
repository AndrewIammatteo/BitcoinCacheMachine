#!/bin/bash

BCM_CHAIN="mainnet"

for i in "$@"; do
    case $i in
        --chain=*)
            BCM_CHAIN="${i#*=}"
            shift # past argument=value
        ;;
        *)
    esac
done

# ZMQ BLOCKS
BITCOIND_MAINNET_ZMQ_BLOCK_PORT=9332
BITCOIND_TESTNET_ZMQ_BLOCK_PORT=19332
BITCOIND_REGTEST_ZMQ_BLOCK_PORT=29332

# ZMQ TX
BITCOIND_MAINNET_ZMQ_TX_PORT=9331
BITCOIND_TESTNET_ZMQ_TX_PORT=19331
BITCOIND_REGTEST_ZMQ_TX_PORT=29331

# RPC
BITCOIND_MAINNET_RPC_PORT=8332
BITCOIND_TESTNET_RPC_PORT=18332
BITCOIND_REGTEST_RPC_PORT=28332

# P2P
BITCOIND_MAINNET_P2P_PORT=8333
BITCOIND_TESTNET_P2P_PORT=18333
BITCOIND_REGTEST_P2P_PORT=28333


# ENV should be specified in DOCKERFILE
STACK_GOGO_FILE=
BITCOIND_CHAIN_TEXT=""
BITCOIND_RPC_PORT="$BITCOIND_MAINNET_RPC_PORT"
BITCOIND_ZMQ_BLOCK_PORT="$BITCOIND_MAINNET_ZMQ_BLOCK_PORT"
BITCOIND_ZMQ_TX_PORT="$BITCOIND_MAINNET_ZMQ_TX_PORT"

if [[ "$BCM_ACTIVE_CHAIN" == "testnet" ]]; then
    STACK_GOGO_FILE=/root/.bitcoin/testnet3/gogo
    BITCOIND_CHAIN_TEXT="-testnet"
    BITCOIND_RPC_PORT="$BITCOIND_TESTNET_RPC_PORT"
    BITCOIND_ZMQ_BLOCK_PORT="$BITCOIND_TESTNET_ZMQ_BLOCK_PORT"
    BITCOIND_ZMQ_TX_PORT="$BITCOIND_TESTNET_ZMQ_TX_PORT"
    elif [[ "$BCM_ACTIVE_CHAIN" == "regtest" ]]; then
    STACK_GOGO_FILE=/root/.bitcoin/regtest/gogo
    BITCOIND_CHAIN_TEXT="-regtest"
    BITCOIND_RPC_PORT="$BITCOIND_REGTEST_RPC_PORT"
    BITCOIND_ZMQ_BLOCK_PORT="$BITCOIND_REGTEST_ZMQ_BLOCK_PORT"
    BITCOIND_ZMQ_TX_PORT="$BITCOIND_REGTEST_ZMQ_TX_PORT"
fi

export STACK_GOGO_FILE="$STACK_GOGO_FILE"
export BITCOIND_CHAIN_TEXT="$BITCOIND_CHAIN_TEXT"
export BITCOIND_RPC_PORT="$BITCOIND_RPC_PORT"
export BITCOIND_ZMQ_BLOCK_PORT="$BITCOIND_ZMQ_BLOCK_PORT"
export BITCOIND_ZMQ_TX_PORT="$BITCOIND_ZMQ_TX_PORT"
