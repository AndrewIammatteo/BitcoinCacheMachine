version: '3.6'
services:
  private-registry:
    image: registry:latest
    ports: 
      - "5005:5000"
    volumes:
      - private-registry-data:/data
    environment:
      BCM_REGISTRY_HOSTNAME: ${TARGET_HOST}
    #   REGISTRY_HTTP_SECRET: ${REGISTRY_HTTP_SECRET:-CHANGEME}
    configs:
      - source: regmirror_config
        target: /etc/docker/registry/config.yml
        uid: '33'
        gid: '33'
        mode: 0640
    # secrets:
    #   - source: privreg_tls_cert
    #     target: /var/lib/registry/privreg.cert
    #     uid: '0'
    #     gid: '0'
    #     mode: 0400
    #   - source: privreg_tls_key
    #     target: /var/lib/registry/privreg.key
    #     uid: '0'
    #     gid: '0'
    #     mode: 0400
    deploy:
      replicas: 1
      placement:
        constraints:
          - node.hostname == ${TARGET_HOST}

volumes:
  private-registry-data:

# secrets:
#   privreg_tls_cert:
#     file: "privreg.cert"
#   privreg_tls_key:
#     file: "privreg.key"

configs:
  regmirror_config:
    file: config.yml
