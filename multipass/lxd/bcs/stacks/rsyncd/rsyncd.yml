version: '3.6'
services:
  rsyncd:
    image: ${BCS_INSTALL_RSYNCD_BUILD_IMAGE:-cachestack.lan/rsyncd:latest}
    ports: 
      - "873:873"
      - "9000:22"
    volumes:
      - rsync-data:/data
    configs:
      - source: rsync_conf
        target: /etc/rsyncd.conf
        uid: '0'
        gid: '0'
        mode: 0400
    secrets:
      - source: ssh_pubkeys
        target: /secrets/authorized_hosts
        uid: '0'
        gid: '0'
        mode: 0644
    deploy:
      mode: replicated
      replicas: 1

volumes:
  rsync-data:

secrets:
  ssh_pubkeys:
    file: "./.ssh/authorized_keys"

configs:
  rsync_conf:
    file: "./rsyncd.conf"